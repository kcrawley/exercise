var campaignManager={basepath:"",clientId:null,contactId:null,projectId:null,jid:null,clientData:{},initialize:function(){this.getClientData();this.events()},events:function(){$(document).on("click","#learnMore",function(){$("#moreinfo").modal()});$(document).on("click","#addNewClient",function(){campaignManager.loadModal("client",null)});$(document).on("click","#addNewContact",function(){var e=$(document).find("#editClient").attr("clientid");campaignManager.loadModal("contact",e)});$(document).on("click","#addNewProject",function(){var e=$(document).find("#editClient").attr("clientid");campaignManager.loadModal("project",e)});$(document).on("click","#editClient",function(){campaignManager.clientId=$(this).attr("clientid");campaignManager.editModal("client",campaignManager.clientId,null)});$(document).on("click","#editContact",function(){var e=$(this).attr("jid");campaignManager.clientId=$(document).find("#editClient").attr("clientid");campaignManager.editModal("contact",campaignManager.clientId,e)});$(document).on("click","#editProject",function(){var e=$(this).attr("jid");campaignManager.clientId=$(document).find("#editClient").attr("clientid");campaignManager.editModal("project",campaignManager.clientId,e)});$(document).on("click","#triggerDelete",function(){var e=$("form").serialize();$.post(campaignManager.basepath+"/delete",e,function(){$("#modal").modal("hide");campaignManager.getClientData()})});$(document).on("keyup","input.client-name",function(){var e=$("form#client-form").serialize();$.post(campaignManager.basepath+"/validateClientName",e,function(e){if(e.status===!0){$("#client-name-group").removeClass("has-error");$("#client-name-group").addClass("has-success");$("#client-modal #triggerSave").removeClass("btn-warning");$("#client-modal #triggerSave").addClass("btn-primary")}else{$("#client-name-group").removeClass("has-success");$("#client-name-group").addClass("has-error");$("#client-modal #triggerSave").removeClass("btn-primary");$("#client-modal #triggerSave").addClass("btn-warning")}})});$(document).on("click","#modal #triggerSave",function(){campaignManager.executeSave()});$(document).on("click","#project-type ul.data-list li a",function(e){e.preventDefault();var t=$(document).find("#client .client-primary").attr("clientid"),n=$(this).parent().attr("jid");campaignManager.swapProjectButton(t,n);campaignManager.loadProjectInfo(t,n)});$(document).on("click","#client-contact ul.data-list li a",function(e){e.preventDefault();var t=$(document).find("#client .client-primary").attr("clientid"),n=$(this).parent().attr("jid");campaignManager.swapContactButton(t,n);campaignManager.loadContactInfo(t,n)});$(document).on("click","#client ul.data-list li a",function(e){e.preventDefault();var t=$(this).parent().attr("id");campaignManager.swapClientButton(t);campaignManager.loadClientInfo(t);campaignManager.populateContactList(t);campaignManager.populateProjectList(t);$("#formatted-contact-list").empty();$("#formatted-project-list").empty()})},getClientData:function(){this.clientData={};$.getJSON(campaignManager.basepath+"/clients",function(e){$.each(e.package,function(e,t){campaignManager.clientData[t.id]=t});campaignManager.resetForm()})},populateClientList:function(){var e=[];$.each(this.clientData,function(t,n){e.push('<li id="'+n.id+'"><a href="#">'+n.name+"</a></li>")});$("#client ul.data-list").html(e)},populateContactList:function(e){var t=[];if(e!==undefined){var n=this.clientData[e].clientContacts;n!==undefined?$.each(this.clientData[e].clientContacts,function(e,n){t.push('<li jid="'+e+'" id="'+n.id+'"><a href="#">'+n.contact_name+"</a></li>")}):t.push("<li><a>No records found.</a></li>");this.setAddNew("contact")}else t.push("<li><a>Please choose a client.</a></li>");$("#client-contact ul.data-list").html(t)},populateProjectList:function(e){var t=[];if(e!==undefined){var n=this.clientData[e].campaignProjectTypes;n!==undefined?$.each(this.clientData[e].campaignProjectTypes,function(e,n){t.push('<li jid="'+e+'" id="'+n.id+'"><a href="#">'+n.project_name+"</a></li>")}):t.push("<li><a>No records found.</a></li>");this.setAddNew("project")}else t.push("<li><a>Please choose a client.</a></li>");$("#project-type ul.data-list").html(t)},loadClientInfo:function(e){var t=campaignManager.clientData[e].name,n=campaignManager.clientData[e].notes,r=[];r.push("<dt>"+t+"</dt>");r.push("<dd>"+n+"</dd>");$("#formatted-client-list").html(r)},loadContactInfo:function(e,t){var n=campaignManager.clientData[e].clientContacts[t].contact_name,r=campaignManager.clientData[e].clientContacts[t].notes,i=[];i.push("<dt>"+n+"</dt>");i.push("<dd>"+r+"</dd>");$("#formatted-contact-list").html(i)},loadProjectInfo:function(e,t){var n=campaignManager.clientData[e].campaignProjectTypes[t].project_name,r=campaignManager.clientData[e].campaignProjectTypes[t].notes,i=[];i.push("<dt>"+n+"</dt>");i.push("<dd>"+r+"</dd>");$("#formatted-project-list").html(i)},swapClientButton:function(e){e!==undefined&&$(".client-primary").attr("id","editClient").html(campaignManager.clientData[e].name).attr("clientid",e);$(document).find("#client ul.data-list #addNewClient").length===0&&$("#client ul.data-list").prepend('<li><a id="addNewClient" style="cursor: pointer; ">Add New Record</a></li>')},swapContactButton:function(e,t){e!==undefined&&t!==undefined&&$(".contact-primary").attr("id","editContact").html(campaignManager.clientData[e].clientContacts[t].contact_name).attr("contactid",campaignManager.clientData[e].clientContacts[t].id).attr("jid",t);$(document).find("#client-contact ul.data-list #addNewContact").length===0&&$("#client-contact ul.data-list").prepend('<li><a id="addNewContact" style="cursor: pointer; ">Add New Record</a></li>')},swapProjectButton:function(e,t){e!==undefined&&t!==undefined&&$(".project-primary").attr("id","editProject").html(campaignManager.clientData[e].campaignProjectTypes[t].project_name).attr("projectid",campaignManager.clientData[e].campaignProjectTypes[t].id).attr("jid",t);$(document).find("#project-type ul.data-list #addNewProject").length===0&&$("#project-type ul.data-list").prepend('<li><a id="addNewProject" style="cursor: pointer; ">Add New Record</a></li>')},loadModal:function(e,t){$.getJSON(campaignManager.basepath+"/modal","modalType="+e,function(e){$("#modal").html(e.html);$(document).find('input[name="campaign_client_id"]').val(t)});$("#modal").modal()},executeSave:function(){var e=$("form").serialize(),t=$("input[name='method']").val(),n=campaignManager.basepath+"/"+t;t!=="add"&&this.clientId!==null&&(n+="/"+this.clientId);$.post(n,e,function(e){if(e.status===!0){$("#modal").modal("hide");campaignManager.getClientData()}else $("#modal").html(e.html)})},editModal:function(e,t,n){$.getJSON(campaignManager.basepath+"/modal","modalType="+e,function(r){$("#modal").html(r.html);campaignManager.clientId=t;switch(e){case"client":var i=campaignManager.clientData[t].name,s=campaignManager.clientData[t].notes,o=campaignManager.clientData[t].id;$(document).find('input[name="name"]').val(i);break;case"contact":var u=campaignManager.clientData[t].clientContacts[n].contact_name,s=campaignManager.clientData[t].clientContacts[n].notes,o=campaignManager.clientData[t].clientContacts[n].id;$(document).find('input[name="contact_name"]').val(u);break;case"project":var a=campaignManager.clientData[t].campaignProjectTypes[n].project_name,s=campaignManager.clientData[t].campaignProjectTypes[n].notes,o=campaignManager.clientData[t].campaignProjectTypes[n].id;$(document).find('input[name="project_name"]').val(a)}$(document).find('input[name="campaign_client_id"]').val(t);$(document).find('textarea[name="notes"]').val(s);$(document).find('input[name="method"]').val("update");$(document).find('input[name="record_id"]').val(o);$(".dialog-footer").append('<button id="triggerDelete" type="button" class="btn btn-danger">Delete Record</button>')});$("#modal").modal()},resetForm:function(){this.populateClientList();this.populateContactList();this.populateProjectList();this.setAddNew("client");this.setAddNew("contact-empty");this.setAddNew("project-empty");$("#formatted-client-list").empty();$("#formatted-contact-list").empty();$("#formatted-project-list").empty()},setAddNew:function(e){switch(e){case"client":$(".client-primary").attr("id","addNewClient").html("Add New Client");break;case"contact":$(".contact-primary").attr("id","addNewContact").html("Add New Contact");break;case"project":$(".project-primary").attr("id","addNewProject").html("Add New Record");break;case"contact-empty":$(".contact-primary").attr("id","").html("Please choose a client...");break;case"project-empty":$(".project-primary").attr("id","").html("Please choose a client...")}}};